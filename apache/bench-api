#!/usr/bin/env sh
#
# Benchmarks an API call and saves the output to a file
URI=$1
START_RATE=100
RATE_STEP=100
END_RATE=1001
TEST_TIME=2

ulimit -S -n $(($END_RATE + 1000))
rm -rf testdata
mkdir -p testdata

CUR_RATE=$START_RATE
while [ $CUR_RATE -lt $END_RATE ]
do
echo "Testing $CUR_RATE concurrent connections for $TEST_TIME seconds."
ab -q -n 1000000 -c $CUR_RATE -r -t $TEST_TIME $URI > testdata/$CUR_RATE.dat
CUR_RATE=$(($CUR_RATE + $RATE_STEP))
done

